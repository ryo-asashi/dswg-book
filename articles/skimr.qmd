---
title: "skimr"
author: "データサイエンス関連基礎調査WG"
date: "`r Sys.Date()`"
format: html
---

```{r setup, include = FALSE}

# install packages
pkgs <- c("skimr", "dplyr")
for (pkg in pkgs) {
  if (!(pkg %in% installed.packages())) {
    install.packages(pkg)
  }
}

# detach packages
default <- c(".GlobalEnv", "tools:rstudio", "tools:vscode",
             "package:stats", "package:graphics",
             "package:grDevices", "package:utils",
             "package:datasets", "package:methods",
             "Autoloads", "package:base")
for (pkg in setdiff(search(), default)) {
  detach(pkg, character.only = TRUE)
  }

# clear objects
remove(list=objects())
```

## パッケージの概要

[**skimr**](https://cran.r-project.org/web/packages/skimr/) パッケージはデータフレームの要約に特化したパッケージです。`skimr()` 関数を用いることで、R の標準関数である `summary()` よりも詳細かつ視認性の高い要約を得ることができます。

## データフレームを要約する

`skim()` 関数をデータフレームに適用すると、特徴量ごとに欠損値の数（n_missing）、非欠損値の割合（complete_rate）、数値型（numeric）の特徴量の平均および標準偏差、因子型（factor）の特徴量の最頻水準や水準数などの要約が出力されます。特に、数値変数について簡易的なヒストグラムが出力される点が特徴的です。

```{r Matrix}
library(skimr)
skim(iris)
```

### 要約結果を加工・抽出する

`skim()` 関数の返り値は、"skim_df" という特別なクラスを持つデータフレームです。

```{r}
class(iris_skim <- skim(iris))
```

**skimr** には "skim_df" オブジェクトを加工するための関数が用意されています。たとえば、`yank()` 関数を用いることで特定のデータ型（`skim_type`）に関する情報を取り出すことができます。

```{r, message = FALSE}
# 数値型特徴量を取り出す
iris_skim |> yank("numeric")
```

また、`focus()` 関数を用いることで、特定の列を取り出すことができます。

```{r}
# 一部の要約を選択したのち因子型特徴量を取り出す
iris_skim |> focus(factor.n_unique, factor.ordered) |> yank("factor")
```

### グループ化されたデータフレームを要約する

`skim()` 関数は `group_by()` でグループ化されたデータフレームにも対応しており、各特徴量に関するグループごとの集計結果を出力することができます。

```{r}
iris |> dplyr::group_by(Species) |> skim()
```

### データフレーム以外のオブジェクトを要約する

**skimr** はデータフレームの要約を効率的に行うことを目的として設計されていますが、ベクトル、行列、時系列データなど、データフレームに変換することが可能な他のデータ型のオブジェクトに対しても使うことができます。

```{r}
# integer型ベクトルのスキミング
skim(1:100)

# 行列のスキミング
skim(matrix(1:9, 3, 3))

# 時系列データのスキミング
class(Nile) # ts
skim(Nile)
```

### 要約関数を自作する

`skim_with()` 関数を用いることで、要約関数を自作することも可能です。詳しい使い方はパッケージの [Vignette](https://cran.r-project.org/web/packages/skimr/vignettes/using_skimr.html#modifying-skim) をご参照ください。

```{r}
my_skim <- skim_with(numeric = sfl(n = length, sum = sum))
iris |>
  dplyr::group_by(Species) |>
  my_skim() |>
  focus(numeric.n, numeric.sum)
```
