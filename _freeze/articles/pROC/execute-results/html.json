{
  "hash": "1db8d0ae13df19532c58d76e629ee53b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"pROC\"\nauthor: \"データサイエンス関連基礎調査WG\"\ndate: \"2025-08-01\"\nformat:\n  html:\n    fig-width: 6\n    fig-height: 3\n---\n\n\n\n\n\n\n## パッケージの概要\n\npROCパッケージは、ROC曲線（Receiver Operating Characteristic Curve）の描画や分析に特化して作られたパッケージです。ROC曲線は、二値変数である目的変数（アウトカム変数）と、連続変数である説明変数の関係の強さを評価する手法であり、医療分野における診断マーカーや、より一般には二値分類モデルの精度指標として用いられています。\n\n## ROC曲線を作成する\n\nデータフレームにroc()関数を適用することで、rocオブジェクト（または、rocオブジェクトを要素とするリスト）を作成することができます。rocオブジェクトに対してplot()関数やggroc()関数を適用することで、ROC曲線を描画することができます。\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(pROC)\n\nresponse <- c(0, 0, 0, 1, 0, 1, 1, 1)\nprobability <- 1:8 /10\n(sample.roc <- roc(response, predictor = probability))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nroc.default(response = response, predictor = probability)\n\nData: probability in 4 controls (response 0) < 4 cases (response 1).\nArea under the curve: 0.9375\n```\n\n\n:::\n\n```{.r .cell-code}\nggroc(sample.roc)\n```\n\n::: {.cell-output-display}\n![](pROC_files/figure-html/unnamed-chunk-2-1.png){width=576}\n:::\n:::\n\n\n\n\nなお、ROC曲線は、連続変数を分類に用いるときの「しきい値」を変化させたときの、感度と特異度の変化を平面上にプロットしたものです。\n\nたとえば、予測確率（10%~80%）の値がしきい値 t 以上であるときに response の値を 1 と予測することにすると、t = 10% （すべてを 1 と予測）のとき感度 = 1、特異度 = 0 となり、これはグラフの右上の点に対応しています。t を 20%、30%、...と変化させていったときの点を明示すれば、下のようになります。\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- data.frame(sensitivity = 1 - cumsum(c(0, response)) / 4,\n                 specificity = cumsum(c(0, 1 - response)) / 4,\n                 label = paste0(\"t=\", 1:9 * 10, \"%\"))\n\n# ggplot2 ベースでROCカーブを描画する\nggroc(sample.roc) +\n  geom_label(aes(specificity, sensitivity, label = label), df)\n```\n\n::: {.cell-output-display}\n![](pROC_files/figure-html/unnamed-chunk-3-1.png){width=576}\n:::\n:::\n\n\n\n## AUCを計算する\n\nROC曲線のグラフにおいて、グラフの下の部分の面積をAUC（Area Under the Curve）と呼びます。AUCは、しばしば分類モデルの性能を評価する指標として用いられます。\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(auc(sample.roc))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.9375\n```\n\n\n:::\n\n```{.r .cell-code}\n# 出力される数値は\"auc\"クラスのオブジェクトでもあり、表示方法が設定されている。\nauc(sample.roc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nArea under the curve: 0.9375\n```\n\n\n:::\n:::\n\n\n\n\n## aSAHデータセット\n\npROCパッケージに収録されているaSAHデータセットは、動脈瘤性くも膜下出血患者113名について、以下の情報を記録したものです。\n\n| 変数名  | 概要                                                  |\n|:--------|:------------------------------------------------------|\n| gos6    | 入院6か月後におけるGlasgow Outcome Scaleの値          |\n| outcome | 予後（gos6が3以下かどうかで分類）                     |\n| gender  | 性別                                                  |\n| age     | 年齢                                                  |\n| wfns    | 入院時のWFNS分類（くも膜下出血の重症度分類の一種）    |\n| s100b   | 入院後12時間以内に採取された静脈血中のS100β濃度       |\n| ndka    | 静脈血中のNDKA（ヌクレオシド二リン酸キナーゼA）の濃度 |\n\n\\\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(aSAH, package = \"pROC\")\nDT::datatable(aSAH)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-ee84c275dc42ca5081ad\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ee84c275dc42ca5081ad\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\"110\",\"111\",\"112\",\"113\",\"114\",\"115\",\"116\",\"117\",\"118\",\"119\",\"120\",\"121\",\"122\",\"123\",\"124\",\"125\",\"126\",\"127\",\"128\",\"129\",\"130\",\"131\",\"132\",\"133\",\"134\",\"135\",\"136\",\"137\",\"138\",\"139\",\"140\",\"141\"],[\"5\",\"5\",\"5\",\"5\",\"1\",\"1\",\"4\",\"1\",\"5\",\"4\",\"1\",\"5\",\"3\",\"1\",\"5\",\"5\",\"1\",\"5\",\"3\",\"1\",\"3\",\"5\",\"3\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"1\",\"5\",\"5\",\"1\",\"3\",\"5\",\"3\",\"3\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"3\",\"3\",\"5\",\"5\",\"4\",\"1\",\"5\",\"5\",\"5\",\"1\",\"5\",\"1\",\"5\",\"4\",\"1\",\"1\",\"1\",\"5\",\"3\",\"1\",\"5\",\"1\",\"3\",\"1\",\"1\",\"5\",\"5\",\"5\",\"1\",\"3\",\"5\",\"1\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"1\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"5\",\"4\",\"5\",\"1\",\"1\",\"1\",\"3\",\"1\",\"1\",\"5\",\"5\",\"4\",\"1\",\"5\",\"5\",\"5\"],[\"Good\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Poor\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Poor\",\"Poor\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Poor\",\"Poor\",\"Poor\",\"Poor\",\"Poor\",\"Good\",\"Good\",\"Good\",\"Poor\",\"Good\",\"Good\",\"Good\"],[\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Male\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Male\",\"Male\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Male\",\"Male\",\"Male\",\"Male\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Female\",\"Male\",\"Male\",\"Male\",\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Male\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Male\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Male\",\"Female\",\"Female\",\"Female\",\"Male\",\"Male\",\"Female\",\"Female\",\"Male\"],[42,37,42,27,42,48,57,41,49,75,37,49,49,71,64,49,63,33,51,54,78,47,56,76,58,50,36,43,61,31,58,61,76,54,55,57,64,67,71,74,72,62,65,50,51,50,35,44,45,48,61,36,53,66,73,58,31,28,32,36,47,29,46,73,45,40,50,57,37,60,53,57,56,31,59,66,50,54,55,51,44,45,47,57,29,52,18,68,47,45,34,60,33,38,48,67,64,70,24,74,42,63,81,62,33,51,29,68,53,58,32,39,34],[\"1\",\"1\",\"1\",\"1\",\"3\",\"2\",\"5\",\"4\",\"1\",\"2\",\"5\",\"2\",\"5\",\"5\",\"1\",\"2\",\"5\",\"2\",\"2\",\"5\",\"2\",\"1\",\"1\",\"1\",\"1\",\"2\",\"1\",\"2\",\"1\",\"1\",\"3\",\"4\",\"2\",\"1\",\"4\",\"5\",\"4\",\"1\",\"4\",\"2\",\"5\",\"5\",\"1\",\"1\",\"2\",\"4\",\"1\",\"1\",\"2\",\"5\",\"5\",\"2\",\"1\",\"2\",\"5\",\"1\",\"2\",\"2\",\"2\",\"1\",\"5\",\"1\",\"1\",\"2\",\"5\",\"2\",\"1\",\"4\",\"5\",\"2\",\"4\",\"4\",\"1\",\"4\",\"1\",\"2\",\"1\",\"4\",\"2\",\"1\",\"2\",\"3\",\"2\",\"4\",\"2\",\"1\",\"4\",\"5\",\"1\",\"1\",\"5\",\"4\",\"2\",\"2\",\"1\",\"1\",\"1\",\"3\",\"1\",\"2\",\"5\",\"2\",\"2\",\"5\",\"5\",\"5\",\"2\",\"4\",\"4\",\"5\",\"1\",\"1\",\"1\"],[0.13,0.14,0.1,0.04,0.13,0.1,0.47,0.16,0.18,0.1,0.12,0.1,0.44,0.71,0.04,0.08,0.49,0.04,0.07000000000000001,0.33,0.09,0.09,0.07000000000000001,0.11,0.07000000000000001,0.17,0.07000000000000001,0.11,0.13,0.19,0.05,0.16,0.41,0.14,0.34,0.35,0.48,0.09,0.96,0.25,0.5,0.46,0.16,0.07000000000000001,0.43,0.45,0.11,0.08,0.09,0.86,0.52,0.08,0.06,0.13,2.07,0.1,0.14,0.15,0.07000000000000001,0.06,0.77,0.05,0.09,0.3,0.03,0.09,0.04,0.23,0.7,0.09,0.27,0.71,0.08,0.26,0.08,0.16,0.09,0.13,0.1,0.08,0.11,0.33,0.11,0.28,0.07000000000000001,0.1,0.32,0.22,0.07000000000000001,0.05,0.24,0.38,0.1,0.15,0.08,0.14,0.1,0.07000000000000001,0.04,0.19,0.5600000000000001,0.14,0.58,0.32,0.82,0.74,0.15,0.47,0.17,0.44,0.15,0.5,0.48],[3.01,8.539999999999999,8.09,10.42,17.4,12.75,6,13.2,15.54,6.01,15.96,17.86,5.18,8.9,13.41,20.75,11.6,16.11,32.37,54.82,32.41,49.94,40.34,9.470000000000001,6.29,12.53,6.54,6.3,80.3,12.8,9.800000000000001,9.81,9.85,18.21,5.03,14.04,21.93,8.02,7.42,8.380000000000001,6.59,9.630000000000001,13.12,7.96,14.34,41.43,7.63,7.06,12.59,13.56,3.87,9.44,7.66,12.98,419.19,27.19,22.27,9.949999999999999,21.22,11.73,10.4,58.83,6.39,11.09,12.22,13.67,17.21,22.63,12.9,9.699999999999999,21.57,8.23,72.56999999999999,15.54,10.51,10.6,14.57,5.19,9.630000000000001,4.61,21.48,17.3,12.71,9.44,11.07,19.46,10.83,5.37,11.97,7.75,9.83,10.55,28.49,8.529999999999999,12.57,12.9,46.83,11.68,12.67,9.01,9.57,34.06,11.72,14.26,47.61,11.67,24.58,10.33,13.87,15.89,22.43,6.79,13.45]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>gos6<\\/th>\\n      <th>outcome<\\/th>\\n      <th>gender<\\/th>\\n      <th>age<\\/th>\\n      <th>wfns<\\/th>\\n      <th>s100b<\\/th>\\n      <th>ndka<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[4,6,7]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"gos6\",\"targets\":1},{\"name\":\"outcome\",\"targets\":2},{\"name\":\"gender\",\"targets\":3},{\"name\":\"age\",\"targets\":4},{\"name\":\"wfns\",\"targets\":5},{\"name\":\"s100b\",\"targets\":6},{\"name\":\"ndka\",\"targets\":7}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n合計113件のデータのうち、41件が予後良好（Good）、72件が予後不良（Poor）です。これを、データの他の指標から判定ないし予測できるかどうかを、ROC曲線で表現します。\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nROCs <- roc(outcome ~ age + s100b + ndka, data = aSAH)\n\n# plot()関数による描画\nplot(ROCs$s100b)\n```\n\n::: {.cell-output-display}\n![](pROC_files/figure-html/roc-1.png){width=576}\n:::\n\n```{.r .cell-code}\n# ggroc()関数によるggplot2ベースの描画\nggroc(ROCs, legacy.axes = FALSE)\n```\n\n::: {.cell-output-display}\n![](pROC_files/figure-html/roc-2.png){width=576}\n:::\n:::\n\n\n\n\n各 ROC 曲線について AUC（ROC-AUC）の値は以下の通りとなり、くも膜下出血の予後の指標としては `s100b` の精度が他の指標よりも良いことが読み取れます。\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# auc()関数をrocオブジェクトにまとめて適用する\nsapply(ROCs, auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      age     s100b      ndka \n0.6150068 0.7313686 0.6119580 \n```\n\n\n:::\n:::\n",
    "supporting": [
      "pROC_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}